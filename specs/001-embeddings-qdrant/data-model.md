# Data Models: Embeddings & Qdrant Integration

## Core Entities

### Text Chunk
**Description**: A segment of book content with associated metadata for RAG operations.

**Fields**:
- `id` (str): Unique identifier for the chunk (auto-generated)
- `page_url` (str): URL of the source page in the Docusaurus book
- `title` (str): Title of the source page
- `heading` (str): Heading associated with this chunk (optional)
- `chunk_index` (int): Sequential index of this chunk within the page
- `text` (str): The actual text content of the chunk (300-1000 tokens)
- `created_at` (datetime): Timestamp when the chunk was created
- `source_hash` (str): Hash of the original content for change detection

**Validation Rules**:
- Text must be between 300-1000 tokens
- page_url must be a valid URL path
- chunk_index must be non-negative

### Embedding Vector
**Description**: Numerical representation of text content generated by the Cohere model.

**Fields**:
- `id` (str): Unique identifier for the embedding (matches the chunk id)
- `vector` (List[float]): The embedding vector (1024-dimensional for multilingual-v3.0)
- `chunk_id` (str): Reference to the associated text chunk
- `model_name` (str): Name of the model used to generate the embedding
- `model_version` (str): Version of the model used
- `created_at` (datetime): Timestamp when the embedding was generated

**Validation Rules**:
- Vector must have exactly 1024 dimensions (for multilingual model)
- chunk_id must reference an existing text chunk
- model_name must be a valid Cohere model identifier

### Qdrant Collection
**Description**: Container for embeddings with cosine distance metric, designed for similarity search operations.

**Fields**:
- `name` (str): Name of the Qdrant collection
- `vector_size` (int): Size of vectors in the collection (1024 for Cohere multilingual model)
- `distance_metric` (str): Distance metric used (cosine)
- `point_count` (int): Number of vectors stored in the collection
- `created_at` (datetime): Timestamp when the collection was created

**Validation Rules**:
- vector_size must match the embedding model dimensions
- distance_metric must be one of: cosine, euclidean, dot
- name must be unique within the Qdrant instance

### Book Content
**Description**: The original text from the humanoid robotics book, extracted from Docusaurus pages and processed for RAG use.

**Fields**:
- `page_url` (str): URL of the page in the Docusaurus book
- `title` (str): Title of the page
- `content` (str): Cleaned text content from the page (HTML removed)
- `last_modified` (datetime): Last modification time of the source page
- `word_count` (int): Number of words in the cleaned content
- `chunk_count` (int): Number of chunks this content was split into

**Validation Rules**:
- content must not contain HTML tags
- word_count must be positive
- page_url must be a valid path

## Relationships

### Text Chunk → Embedding Vector (1:1)
- Each text chunk has exactly one associated embedding vector
- The relationship is identified by matching IDs

### Text Chunk → Book Content (N:1)
- Multiple text chunks can originate from the same book content page
- Identified by the page_url field

### Embedding Vector → Qdrant Collection (N:1)
- Multiple embedding vectors are stored in the same Qdrant collection
- Identified by the collection configuration

## State Transitions

### Text Chunk States
- `EXTRACTED`: Content has been extracted but not yet chunked
- `CHUNKED`: Content has been split into appropriate sized chunks
- `EMBEDDED`: Embeddings have been generated for the chunk
- `STORED`: Chunk and embedding have been stored in Qdrant
- `VALIDATED`: Chunk has passed validation checks

### Processing Workflow
1. Book content is extracted and marked as `EXTRACTED`
2. Content is chunked and chunks marked as `CHUNKED`
3. Embeddings are generated and chunks marked as `EMBEDDED`
4. Embeddings are stored in Qdrant and chunks marked as `STORED`
5. Validation is performed and chunks marked as `VALIDATED`

## Data Validation Requirements

### Content Quality Checks
- Remove navigation elements, headers, footers, and code blocks
- Preserve meaningful text content
- Maintain semantic boundaries when chunking

### Embedding Integrity Checks
- Verify vector dimensions match model specifications
- Confirm embeddings were generated with the correct model
- Validate that embedding IDs match source chunks

### Storage Validation
- Confirm vector count matches chunk count
- Verify metadata is correctly associated with embeddings
- Ensure collection properties match requirements